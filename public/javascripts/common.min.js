$(function(){document.oncontextmenu=function(){return false};$(window).unload(function(){$("iframe").each(function(){this.contentWindow.document.write("");this.contentWindow.close();this.remove()})});window.moduleMain=moduleMain={};var a={};function f(k,m,o){var l=$("#"+k);if(l.length>0){var j=Math.round((Math.random()*1000)+1000);l.flip({delay:j});var n=$('<iframe  frameborder=0 border=0 hspace=0  vspace=0 scrolling="no" marginwidth="0" marginheight="0" >');n.css("background-color","transparent");n.attr("allowTransparency","true");n.attr("height","100%");n.attr("width","100%");n.attr("src",getRealPath()+"/"+m.temp_url);n.attr("id",m.id);l.attr("cardId",m.id);var i=$('<div class="card-body"></div>').css({height:"100%",width:"100%"}).attr("id",m.id);i.append($('<div class="inner"></div>').append(n));i.data("id",m.id);l.append(i);n.load(function(){this.contentWindow.Main._offset=$(this).parents(".module").offset();moduleMain[this.id]=this.contentWindow.Main;a[this.id]=this.contentWindow;o(i)})}}function e(j,l,n){var k=$("#"+j);if(k.length>0){var m=$('<iframe  frameborder=0 border=0 hspace=0  vspace=0 scrolling="no" marginwidth="0" marginheight="0" >');m.css("background-color","transparent");m.attr("allowTransparency","true");m.attr("height","100%");m.attr("width","100%");m.attr("src",getRealPath()+"/"+l.temp_url);m.attr("id",l.id);var i=$('<div class="card-body" ></div>').css({height:"100%",width:"100%"}).attr("id",l.id);i.append($('<div class="inner"></div>').append(m));i.data("id",l.id);k.append(i);m.load(function(){this.contentWindow.Main._offset=$(this).parents(".module").offset();moduleMain[this.id]=this.contentWindow.Main;a[this.id]=this.contentWindow;n(i)})}}function g(l){var m=$('<div  class="btn-group lock-btn"></div>');var k=$('<span class="group"></span>');var j=$('<input class="lock" type="checkbox">').attr("id","lock-"+l).val(l).attr("checked","checked");var i=$('<label  title="锁定"></label>').attr("for","lock-"+l);k.append(j).append(i);return m.append(k)}function b(i){if(i.children().length<2){return}var k=i.offset();var j=g(i.attr("id"));j.css({position:"absolute",left:k.left+i.width()-45,top:k.top+5});$("#main").append(j)}var c={};function h(){var j=true;for(var i in c){if(!c[i]){j=false}}return j}function d(){$(".flip").each(function(){if($(this).children(".card-body").length<2){return}b($(this))});$("body").on("change",".lock",function(){if($("#"+this.value).flip("__direction")=="+"){$("#"+this.value).flip("back")}else{$("#"+this.value).flip("positive")}})}$.get(Interface.templateRest.getTemplate,{temp_id:templateId},function(j){if(!j){return}var n=JSON.parse(j.data.temp_json);var p={};$.each(n.positive,function(i,q){if(p[i]){p[i].push(q)}else{p[i]=[];p[i].push(q)}});$.each(n.back,function(i,q){if(p[i]){p[i].push(q)}else{p[i]=[];p[i].push(q)}c[q.id]=false});for(var k in p){if(p[k].length>1){var m=p[k];for(var l=0;l<m.length;l++){c[m[l].id]=false;f(k,m[l],function(i){c[i.data("id")]=true;if(h()){d()}})}}else{var o=p[k][0];c[o.id]=false;e(k,o,function(i){c[i.data("id")]=true;if(h()){d()}})}}},"json");$(function(){$.get("btns.json",{},function(o){var q=[];var p=[];$.each(o.data,function(u,x){if(u>3){var t=x.url.indexOf("http")>-1?x.url:getRealPath()+"/"+x.url;var v=$("<li></li>").data("url",t).data("target",x.target),r=$('<label class="group-label"></label>').html(x.name);var w=$("<a>").attr("id","menu_"+x.id).attr("href","javascript:MenuClick('"+t+"','"+x.target+"')");p.push(v.append(w.append(r)))}else{var t=x.url.indexOf("http")>-1?x.url:getRealPath()+"/"+x.url;var y=$('<li class="menu-item"></li>').data("url",t),s=$('<span  class="group-icon"></span>');if(selectId==x.id){s.css({"background-image":"url(icon/"+x.icon+"1.png)"})}else{s.css({"background-image":"url(icon/"+x.icon+"0.png)"}).data("icon",x.icon)}r=$('<label class="group-label"></label>').html(x.name);var w=$("<a>").attr("id","menu_"+x.id).attr("href","javascript:MenuClick('"+t+"','"+x.target+"')");w.append(s);w.append(r);y.data("target",x.target);q.push(y.append(w))}});$(".group-button-items").prepend(q);if(p.length>0){$moreUl=$('<ul class="child-menu-item"></ul>').append(p);$(".child-menu").append($moreUl)}},"json");$(".more-item").on("mouseenter",function(){$(this).find(".child-menu").show();if(moduleMain&&moduleMain.map.hide){moduleMain.map.hide()}});$(".more-item").on("mouseleave",function(){$(this).find(".child-menu").hide();if(moduleMain&&moduleMain.map.show){moduleMain.map.show()}});window.MenuClick=function(o,p){if(o){switch(p){case"_blank":window.open(o);break;case"_self":location.href=o;break}}};var n,m=+new Date(),l;var i='{"method":"login","cid":"P001-S001-D001-NAME","type":"Consumer","code":"A001","mode":"0","appid":"-1","filter":"0.0.0.0","version":"1.0.1","requestData":"","user":"tom","pass":"241fcf33eaa2ea61285f36559116cbad","timestamp":"1493979949941"}';var k=function(p,q){this.socket=new ReconnectingWebSocket(p,null,{reconnectInterval:0,maxReconnectInterval:2000});this.shakeMessage=i;var o=this;this.socket.onopen=function(r){if(o.shakeMessage){o.socket.send(o.shakeMessage)}if(q&&typeof(q.openCallback)==="function"){q.openCallback(r)}};this.socket.onclose=function(r){console.info("关闭websocket连接...");if(q&&typeof(q.closeCallback)==="function"){q.closeCallback(r)}};this.socket.onmessage=function(r){if(q&&typeof(q.messageCallback)==="function"){q.messageCallback(r);if(r.data){if((new Date().getTime()-m)>=50000){o.socket.send(o.shakeMessage);m=+new Date()}if(n){clearTimeout(n)}else{}}}};this.socket.onerror=function(r){console.info("websocket连接异常...");if(q&&typeof(q.errorCallback)==="function"){q.errorCallback(r)}}};function j(){if(l){l.socket.close();console.info("关闭websocket");l=null}l=new k(Interface.websocketUrl,{messageCallback:function(q){var o;try{o=JSON.parse(q.data)}catch(p){o=q.data}if(o&&o.type){for(var r in moduleMain){if(moduleMain[r].initSocket){moduleMain[r].initSocket(o)}}}},openCallback:function(o){}})}setTimeout(function(){j()},4000)})});