(function(f){var C={event:{DRAG:"ztree_drag",DROP:"ztree_drop",RENAME:"ztree_rename",DRAGMOVE:"ztree_dragmove"},id:{EDIT:"_edit",INPUT:"_input",REMOVE:"_remove"},move:{TYPE_INNER:"inner",TYPE_PREV:"prev",TYPE_NEXT:"next"},node:{CURSELECTED_EDIT:"curSelectedNode_Edit",TMPTARGET_TREE:"tmpTargetzTree",TMPTARGET_NODE:"tmpTargetNode"}},m={edit:{enable:false,editNameSelectAll:false,showRemoveBtn:true,showRenameBtn:true,removeTitle:"remove",renameTitle:"rename",drag:{autoExpandTrigger:false,isCopy:true,isMove:true,prev:true,next:true,inner:true,minMoveSize:5,borderMax:10,borderMin:-5,maxShowNodeNum:5,autoOpenTime:500}},view:{addHoverDom:null,removeHoverDom:null},callback:{beforeDrag:null,beforeDragOpen:null,beforeDrop:null,beforeEditName:null,beforeRename:null,onDrag:null,onDragMove:null,onDrop:null,onRename:null}},x=function(E){var F=A.getRoot(E),D=A.getRoots();F.curEditNode=null;F.curEditInput=null;F.curHoverNode=null;F.dragFlag=0;F.dragNodeShowBefore=[];F.dragMaskList=new Array();D.showHoverDom=true},c=function(D){},n=function(D){var E=D.treeObj;var F=q.event;E.bind(F.RENAME,function(H,J,I,G){v.apply(D.callback.onRename,[H,J,I,G])});E.bind(F.DRAG,function(H,G,J,I){v.apply(D.callback.onDrag,[G,J,I])});E.bind(F.DRAGMOVE,function(H,G,J,I){v.apply(D.callback.onDragMove,[G,J,I])});E.bind(F.DROP,function(J,I,L,K,M,H,G){v.apply(D.callback.onDrop,[I,L,K,M,H,G])})},z=function(D){var E=D.treeObj;var F=q.event;E.unbind(F.RENAME);E.unbind(F.DRAG);E.unbind(F.DRAGMOVE);E.unbind(F.DROP)},o=function(K){var L=K.target,O=A.getSetting(K.data.treeId),M=K.relatedTarget,I="",E=null,F="",J="",D=null,H=null,G=null;if(v.eqs(K.type,"mouseover")){G=v.getMDom(O,L,[{tagName:"a",attrName:"treeNode"+q.id.A}]);if(G){I=v.getNodeMainDom(G).id;F="hoverOverNode"}}else{if(v.eqs(K.type,"mouseout")){G=v.getMDom(O,M,[{tagName:"a",attrName:"treeNode"+q.id.A}]);if(!G){I="remove";F="hoverOutNode"}}else{if(v.eqs(K.type,"mousedown")){G=v.getMDom(O,L,[{tagName:"a",attrName:"treeNode"+q.id.A}]);if(G){I=v.getNodeMainDom(G).id;F="mousedownNode"}}}}if(I.length>0){E=A.getNodeCache(O,I);switch(F){case"mousedownNode":D=l.onMousedownNode;break;case"hoverOverNode":D=l.onHoverOverNode;break;case"hoverOutNode":D=l.onHoverOutNode;break}}var N={stop:false,node:E,nodeEventType:F,nodeEventCallback:D,treeEventType:J,treeEventCallback:H};return N},w=function(F,J,I,D,H,E,G){if(!I){return}I.isHover=false;I.editNameFlag=false},k=function(E,D){D.cancelEditName=function(G){var F=A.getRoot(this.setting);if(!F.curEditNode){return}j.cancelCurEditNode(this.setting,G?G:null,true)};D.copyNode=function(K,J,I,M){if(!J){return null}var F=A.nodeIsParent(E,K);if(K&&!F&&this.setting.data.keep.leaf&&I===q.move.TYPE_INNER){return null}var L=this,G=v.clone(J);if(!K){K=null;I=q.move.TYPE_INNER}if(I==q.move.TYPE_INNER){function H(){j.addNodes(L.setting,K,-1,[G],M)}if(v.canAsync(this.setting,K)){j.asyncNode(this.setting,K,M,H)}else{H()}}else{j.addNodes(this.setting,K.parentNode,-1,[G],M);j.moveNode(this.setting,K,G,I,false,M)}return G};D.editName=function(F){if(!F||!F.tId||F!==A.getNodeCache(this.setting,F.tId)){return}if(F.parentTId){j.expandCollapseParentNode(this.setting,F.getParentNode(),true)}j.editNode(this.setting,F)};D.moveNode=function(I,H,G,L){if(!H){return H}var F=A.nodeIsParent(E,I);if(I&&!F&&this.setting.data.keep.leaf&&G===q.move.TYPE_INNER){return null}else{if(I&&((H.parentTId==I.tId&&G==q.move.TYPE_INNER)||i(H,this.setting).find("#"+I.tId).length>0)){return null}else{if(!I){I=null}}}var K=this;function J(){j.moveNode(K.setting,I,H,G,false,L)}if(v.canAsync(this.setting,I)&&G===q.move.TYPE_INNER){j.asyncNode(this.setting,I,L,J)}else{J()}return H};D.setEditable=function(F){this.setting.edit.enable=F;return this.refresh()}},p={setSonNodeLevel:function(H,D,I){if(!I){return}var G=A.nodeChildren(H,I);I.level=(D)?D.level+1:0;if(!G){return}for(var F=0,E=G.length;F<E;F++){if(G[F]){A.setSonNodeLevel(H,I,G[F])}}}},g={},l={onHoverOverNode:function(G,F){var E=A.getSetting(G.data.treeId),D=A.getRoot(E);if(D.curHoverNode!=F){l.onHoverOutNode(G)}D.curHoverNode=F;j.addHoverDom(E,F)},onHoverOutNode:function(G,F){var E=A.getSetting(G.data.treeId),D=A.getRoot(E);if(D.curHoverNode&&!A.isSelectedNode(E,D.curHoverNode)){j.removeTreeDom(E,D.curHoverNode);D.curHoverNode=null}},onMousedownNode:function(S,K){var aa,X,R=A.getSetting(S.data.treeId),W=A.getRoot(R),L=A.getRoots();if(S.button==2||!R.edit.enable||(!R.edit.drag.isCopy&&!R.edit.drag.isMove)){return true}var ad=S.target,J=A.getRoot(R).curSelectedList,T=[];if(!A.isSelectedNode(R,K)){T=[K]}else{for(aa=0,X=J.length;aa<X;aa++){if(J[aa].editNameFlag&&v.eqs(ad.tagName,"input")&&ad.getAttribute("treeNode"+q.id.INPUT)!==null){return true}T.push(J[aa]);if(T[0].parentTId!==J[aa].parentTId){T=[K];break}}}j.editNodeBlur=true;j.cancelCurEditNode(R);var ag=f(R.treeObj.get(0).ownerDocument),M=f(R.treeObj.get(0).ownerDocument.body),Z,N,ab,ac=false,ae=R,I=R,D,H,U=null,G=null,Q=null,E=q.move.TYPE_INNER,Y=S.clientX,V=S.clientY,O=(new Date()).getTime();if(v.uCanDo(R)){ag.bind("mousemove",P)}function P(a5){if(W.dragFlag==0&&Math.abs(Y-a5.clientX)<R.edit.drag.minMoveSize&&Math.abs(V-a5.clientY)<R.edit.drag.minMoveSize){return true}var aZ,aV,ay,aQ,aJ;M.css("cursor","pointer");if(W.dragFlag==0){if(v.apply(R.callback.beforeDrag,[R.treeId,T],true)==false){af(a5);return true}for(aZ=0,aV=T.length;aZ<aV;aZ++){if(aZ==0){W.dragNodeShowBefore=[]}ay=T[aZ];if(A.nodeIsParent(R,ay)&&ay.open){j.expandCollapseNode(R,ay,!ay.open);W.dragNodeShowBefore[ay.tId]=true}else{W.dragNodeShowBefore[ay.tId]=false}}W.dragFlag=1;L.showHoverDom=false;v.showIfameMask(R,true);var ai=true,al=-1;if(T.length>1){var aw=T[0].parentTId?A.nodeChildren(R,T[0].getParentNode()):A.getNodes(R);aJ=[];for(aZ=0,aV=aw.length;aZ<aV;aZ++){if(W.dragNodeShowBefore[aw[aZ].tId]!==undefined){if(ai&&al>-1&&(al+1)!==aZ){ai=false}aJ.push(aw[aZ]);al=aZ}if(T.length===aJ.length){T=aJ;break}}}if(ai){D=T[0].getPreNode();H=T[T.length-1].getNextNode()}Z=i("<ul class='zTreeDragUL'></ul>",R);for(aZ=0,aV=T.length;aZ<aV;aZ++){ay=T[aZ];ay.editNameFlag=false;j.selectNode(R,ay,aZ>0);j.removeTreeDom(R,ay);if(aZ>R.edit.drag.maxShowNodeNum-1){continue}aQ=i("<li id='"+ay.tId+"_tmp'></li>",R);aQ.append(i(ay,q.id.A,R).clone());aQ.css("padding","0");aQ.children("#"+ay.tId+q.id.A).removeClass(q.node.CURSELECTED);Z.append(aQ);if(aZ==R.edit.drag.maxShowNodeNum-1){aQ=i("<li id='"+ay.tId+"_moretmp'><a>  ...  </a></li>",R);Z.append(aQ)}}Z.attr("id",T[0].tId+q.id.UL+"_tmp");Z.addClass(R.treeObj.attr("class"));Z.appendTo(M);N=i("<span class='tmpzTreeMove_arrow'></span>",R);N.attr("id","zTreeMove_arrow_tmp");N.appendTo(M);R.treeObj.trigger(q.event.DRAG,[a5,R.treeId,T])}if(W.dragFlag==1){if(ab&&N.attr("id")==a5.target.id&&Q&&(a5.clientX+ag.scrollLeft()+2)>(f("#"+Q+q.id.A,ab).offset().left)){var a4=f("#"+Q+q.id.A,ab);a5.target=(a4.length>0)?a4.get(0):a5.target}else{if(ab){ab.removeClass(q.node.TMPTARGET_TREE);if(Q){f("#"+Q+q.id.A,ab).removeClass(q.node.TMPTARGET_NODE+"_"+q.move.TYPE_PREV).removeClass(q.node.TMPTARGET_NODE+"_"+C.move.TYPE_NEXT).removeClass(q.node.TMPTARGET_NODE+"_"+C.move.TYPE_INNER)}}}ab=null;Q=null;ac=false;ae=R;var a0=A.getSettings();for(var aR in a0){if(a0[aR].treeId&&a0[aR].edit.enable&&a0[aR].treeId!=R.treeId&&(a5.target.id==a0[aR].treeId||f(a5.target).parents("#"+a0[aR].treeId).length>0)){ac=true;ae=a0[aR]}}var av=ag.scrollTop(),a3=ag.scrollLeft(),aj=ae.treeObj.offset(),aD=ae.treeObj.get(0).scrollHeight,aS=ae.treeObj.get(0).scrollWidth,a1=(a5.clientY+av-aj.top),aP=(ae.treeObj.height()+aj.top-a5.clientY-av),aK=(a5.clientX+a3-aj.left),au=(ae.treeObj.width()+aj.left-a5.clientX-a3),ax=(a1<R.edit.drag.borderMax&&a1>R.edit.drag.borderMin),a6=(aP<R.edit.drag.borderMax&&aP>R.edit.drag.borderMin),aN=(aK<R.edit.drag.borderMax&&aK>R.edit.drag.borderMin),ar=(au<R.edit.drag.borderMax&&au>R.edit.drag.borderMin),ak=a1>R.edit.drag.borderMin&&aP>R.edit.drag.borderMin&&aK>R.edit.drag.borderMin&&au>R.edit.drag.borderMin,aH=(ax&&ae.treeObj.scrollTop()<=0),aG=(a6&&(ae.treeObj.scrollTop()+ae.treeObj.height()+10)>=aD),an=(aN&&ae.treeObj.scrollLeft()<=0),aB=(ar&&(ae.treeObj.scrollLeft()+ae.treeObj.width()+10)>=aS);if(a5.target&&v.isChildOrSelf(a5.target,ae.treeId)){var at=a5.target;while(at&&at.tagName&&!v.eqs(at.tagName,"li")&&at.id!=ae.treeId){at=at.parentNode}var aA=true;for(aZ=0,aV=T.length;aZ<aV;aZ++){ay=T[aZ];if(at.id===ay.tId){aA=false;break}else{if(i(ay,R).find("#"+at.id).length>0){aA=false;break}}}if(aA&&a5.target&&v.isChildOrSelf(a5.target,at.id+q.id.A)){ab=f(at);Q=at.id}}ay=T[0];if(ak&&v.isChildOrSelf(a5.target,ae.treeId)){if(!ab&&(a5.target.id==ae.treeId||aH||aG||an||aB)&&(ac||(!ac&&ay.parentTId))){ab=ae.treeObj}if(ax){ae.treeObj.scrollTop(ae.treeObj.scrollTop()-10)}else{if(a6){ae.treeObj.scrollTop(ae.treeObj.scrollTop()+10)}}if(aN){ae.treeObj.scrollLeft(ae.treeObj.scrollLeft()-10)}else{if(ar){ae.treeObj.scrollLeft(ae.treeObj.scrollLeft()+10)}}if(ab&&ab!=ae.treeObj&&ab.offset().left<ae.treeObj.offset().left){ae.treeObj.scrollLeft(ae.treeObj.scrollLeft()+ab.offset().left-ae.treeObj.offset().left)}}Z.css({top:(a5.clientY+av+3)+"px",left:(a5.clientX+a3+3)+"px"});var aF=0;var aE=0;if(ab&&ab.attr("id")!=ae.treeId){var aO=Q==null?null:A.getNodeCache(ae,Q),aI=((a5.ctrlKey||a5.metaKey)&&R.edit.drag.isMove&&R.edit.drag.isCopy)||(!R.edit.drag.isMove&&R.edit.drag.isCopy),ap=!!(D&&Q===D.tId),aM=!!(H&&Q===H.tId),aX=(ay.parentTId&&ay.parentTId==Q),aL=(aI||!aM)&&v.apply(ae.edit.drag.prev,[ae.treeId,T,aO],!!ae.edit.drag.prev),ao=(aI||!ap)&&v.apply(ae.edit.drag.next,[ae.treeId,T,aO],!!ae.edit.drag.next),ah=(aI||!aX)&&!(ae.data.keep.leaf&&!A.nodeIsParent(R,aO))&&v.apply(ae.edit.drag.inner,[ae.treeId,T,aO],!!ae.edit.drag.inner);function a2(){ab=null;Q="";E=q.move.TYPE_INNER;N.css({display:"none"});if(window.zTreeMoveTimer){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}}if(!aL&&!ao&&!ah){a2()}else{var aC=f("#"+Q+q.id.A,ab),aU=aO.isLastNode?null:f("#"+aO.getNextNode().tId+q.id.A,ab.next()),aW=aC.offset().top,aY=aC.offset().left,aT=aL?(ah?0.25:(ao?0.5:1)):-1,aq=ao?(ah?0.75:(aL?0.5:0)):-1,am=(a5.clientY+av-aW)/aC.height();if((aT==1||am<=aT&&am>=-0.2)&&aL){aF=1-N.width();aE=aW-N.height()/2;E=q.move.TYPE_PREV}else{if((aq==0||am>=aq&&am<=1.2)&&ao){aF=1-N.width();aE=(aU==null||(A.nodeIsParent(R,aO)&&aO.open))?(aW+aC.height()-N.height()/2):(aU.offset().top-N.height()/2);E=q.move.TYPE_NEXT}else{if(ah){aF=5-N.width();aE=aW;E=q.move.TYPE_INNER}else{a2()}}}if(ab){N.css({display:"block",top:aE+"px",left:(aY+aF)+"px"});aC.addClass(q.node.TMPTARGET_NODE+"_"+E);if(U!=Q||G!=E){O=(new Date()).getTime()}if(aO&&A.nodeIsParent(R,aO)&&E==q.move.TYPE_INNER){var az=true;if(window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId!==aO.tId){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}else{if(window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId===aO.tId){az=false}}if(az){window.zTreeMoveTimer=setTimeout(function(){if(E!=q.move.TYPE_INNER){return}if(aO&&A.nodeIsParent(R,aO)&&!aO.open&&(new Date()).getTime()-O>ae.edit.drag.autoOpenTime&&v.apply(ae.callback.beforeDragOpen,[ae.treeId,aO],true)){j.switchNode(ae,aO);if(ae.edit.drag.autoExpandTrigger){ae.treeObj.trigger(q.event.EXPAND,[ae.treeId,aO])}}},ae.edit.drag.autoOpenTime+50);window.zTreeMoveTargetNodeTId=aO.tId}}}}}else{E=q.move.TYPE_INNER;if(ab&&v.apply(ae.edit.drag.inner,[ae.treeId,T,null],!!ae.edit.drag.inner)){ab.addClass(q.node.TMPTARGET_TREE)}else{ab=null}N.css({display:"none"});if(window.zTreeMoveTimer){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}}U=Q;G=E;R.treeObj.trigger(q.event.DRAGMOVE,[a5,R.treeId,T])}return false}ag.bind("mouseup",af);function af(ao){if(window.zTreeMoveTimer){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}U=null;G=null;ag.unbind("mousemove",P);ag.unbind("mouseup",af);ag.unbind("selectstart",F);M.css("cursor","");if(ab){ab.removeClass(q.node.TMPTARGET_TREE);if(Q){f("#"+Q+q.id.A,ab).removeClass(q.node.TMPTARGET_NODE+"_"+q.move.TYPE_PREV).removeClass(q.node.TMPTARGET_NODE+"_"+C.move.TYPE_NEXT).removeClass(q.node.TMPTARGET_NODE+"_"+C.move.TYPE_INNER)}}v.showIfameMask(R,false);L.showHoverDom=true;if(W.dragFlag==0){return}W.dragFlag=0;var am,ai,an;for(am=0,ai=T.length;am<ai;am++){an=T[am];if(A.nodeIsParent(R,an)&&W.dragNodeShowBefore[an.tId]&&!an.open){j.expandCollapseNode(R,an,!an.open);delete W.dragNodeShowBefore[an.tId]}}if(Z){Z.remove()}if(N){N.remove()}var ah=((ao.ctrlKey||ao.metaKey)&&R.edit.drag.isMove&&R.edit.drag.isCopy)||(!R.edit.drag.isMove&&R.edit.drag.isCopy);if(!ah&&ab&&Q&&T[0].parentTId&&Q==T[0].parentTId&&E==q.move.TYPE_INNER){ab=null}if(ab){var aj=Q==null?null:A.getNodeCache(ae,Q);if(v.apply(R.callback.beforeDrop,[ae.treeId,T,aj,E,ah],true)==false){j.selectNodes(I,T);return}var ak=ah?v.clone(T):T;function al(){if(ac){if(!ah){for(var ar=0,aq=T.length;ar<aq;ar++){j.removeNode(R,T[ar])}}if(E==q.move.TYPE_INNER){j.addNodes(ae,aj,-1,ak)}else{j.addNodes(ae,aj.getParentNode(),E==q.move.TYPE_PREV?aj.getIndex():aj.getIndex()+1,ak)}}else{if(ah&&E==q.move.TYPE_INNER){j.addNodes(ae,aj,-1,ak)}else{if(ah){j.addNodes(ae,aj.getParentNode(),E==q.move.TYPE_PREV?aj.getIndex():aj.getIndex()+1,ak)}else{if(E!=q.move.TYPE_NEXT){for(ar=0,aq=ak.length;ar<aq;ar++){j.moveNode(ae,aj,ak[ar],E,false)}}else{for(ar=-1,aq=ak.length-1;ar<aq;aq--){j.moveNode(ae,aj,ak[aq],E,false)}}}}}j.selectNodes(ae,ak);var ap=i(ak[0],R).get(0);j.scrollIntoView(R,ap);R.treeObj.trigger(q.event.DROP,[ao,ae.treeId,ak,aj,E,ah])}if(E==q.move.TYPE_INNER&&v.canAsync(ae,aj)){j.asyncNode(ae,aj,false,al)}else{al()}}else{j.selectNodes(I,T);R.treeObj.trigger(q.event.DROP,[ao,R.treeId,T,null,null,null])}}ag.bind("selectstart",F);function F(){return false}if(S.preventDefault){S.preventDefault()}return true}},h={getAbs:function(E){var G=E.getBoundingClientRect(),D=document.body.scrollTop+document.documentElement.scrollTop,F=document.body.scrollLeft+document.documentElement.scrollLeft;return[G.left+F,G.top+D]},inputFocus:function(D){if(D.get(0)){D.focus();v.setCursorPosition(D.get(0),D.val().length)}},inputSelect:function(D){if(D.get(0)){D.focus();D.select()}},setCursorPosition:function(E,F){if(E.setSelectionRange){E.focus();E.setSelectionRange(F,F)}else{if(E.createTextRange){var D=E.createTextRange();D.collapse(true);D.moveEnd("character",F);D.moveStart("character",F);D.select()}}},showIfameMask:function(K,I){var H=A.getRoot(K);while(H.dragMaskList.length>0){H.dragMaskList[0].remove();H.dragMaskList.shift()}if(I){var L=i("iframe",K);for(var G=0,E=L.length;G<E;G++){var F=L.get(G),D=v.getAbs(F),J=i("<div id='zTreeMask_"+G+"' class='zTreeMask' style='top:"+D[1]+"px; left:"+D[0]+"px; width:"+F.offsetWidth+"px; height:"+F.offsetHeight+"px;'></div>",K);J.appendTo(i("body",K));H.dragMaskList.push(J)}}}},d={addEditBtn:function(E,F){if(F.editNameFlag||i(F,q.id.EDIT,E).length>0){return}if(!v.apply(E.edit.showRenameBtn,[E.treeId,F],E.edit.showRenameBtn)){return}var G=i(F,q.id.A,E),D="<span class='"+q.className.BUTTON+" edit' id='"+F.tId+q.id.EDIT+"' title='"+v.apply(E.edit.renameTitle,[E.treeId,F],E.edit.renameTitle)+"' treeNode"+q.id.EDIT+" style='display:none;'></span>";G.append(D);i(F,q.id.EDIT,E).bind("click",function(){if(!v.uCanDo(E)||v.apply(E.callback.beforeEditName,[E.treeId,F],true)==false){return false}j.editNode(E,F);return false}).show()},addRemoveBtn:function(D,E){if(E.editNameFlag||i(E,q.id.REMOVE,D).length>0){return}if(!v.apply(D.edit.showRemoveBtn,[D.treeId,E],D.edit.showRemoveBtn)){return}var G=i(E,q.id.A,D),F="<span class='"+q.className.BUTTON+" remove' id='"+E.tId+q.id.REMOVE+"' title='"+v.apply(D.edit.removeTitle,[D.treeId,E],D.edit.removeTitle)+"' treeNode"+q.id.REMOVE+" style='display:none;'></span>";G.append(F);i(E,q.id.REMOVE,D).bind("click",function(){if(!v.uCanDo(D)||v.apply(D.callback.beforeRemove,[D.treeId,E],true)==false){return false}j.removeNode(D,E);D.treeObj.trigger(q.event.REMOVE,[D.treeId,E]);return false}).bind("mousedown",function(H){return true}).show()},addHoverDom:function(D,E){if(A.getRoots().showHoverDom){E.isHover=true;if(D.edit.enable){j.addEditBtn(D,E);j.addRemoveBtn(D,E)}v.apply(D.view.addHoverDom,[D.treeId,E])}},cancelCurEditNode:function(I,H,G){var E=A.getRoot(I),J=E.curEditNode;if(J){var F=E.curEditInput,D=H?H:(G?A.nodeName(I,J):F.val());if(v.apply(I.callback.beforeRename,[I.treeId,J,D,G],true)===false){return false}A.nodeName(I,J,D);var K=i(J,q.id.A,I);K.removeClass(q.node.CURSELECTED_EDIT);F.unbind();j.setNodeName(I,J);J.editNameFlag=false;E.curEditNode=null;E.curEditInput=null;j.selectNode(I,J,false);I.treeObj.trigger(q.event.RENAME,[I.treeId,J,G])}E.noSelection=true;return true},editNode:function(F,G){var D=A.getRoot(F);j.editNodeBlur=false;if(A.isSelectedNode(F,G)&&D.curEditNode==G&&G.editNameFlag){setTimeout(function(){v.inputFocus(D.curEditInput)},0);return}G.editNameFlag=true;j.removeTreeDom(F,G);j.cancelCurEditNode(F);j.selectNode(F,G,false);i(G,q.id.SPAN,F).html("<input type=text class='rename' id='"+G.tId+q.id.INPUT+"' treeNode"+q.id.INPUT+" >");var E=i(G,q.id.INPUT,F);E.attr("value",A.nodeName(F,G));if(F.edit.editNameSelectAll){v.inputSelect(E)}else{v.inputFocus(E)}E.bind("blur",function(H){if(!j.editNodeBlur){j.cancelCurEditNode(F)}}).bind("keydown",function(H){if(H.keyCode=="13"){j.editNodeBlur=true;j.cancelCurEditNode(F)}else{if(H.keyCode=="27"){j.cancelCurEditNode(F,null,true)}}}).bind("click",function(H){return false}).bind("dblclick",function(H){return false});i(G,q.id.A,F).addClass(q.node.CURSELECTED_EDIT);D.curEditInput=E;D.noSelection=false;D.curEditNode=G},moveNode:function(O,H,R,F,ad,I){var T=A.getRoot(O);if(H==R){return}if(O.data.keep.leaf&&H&&!A.nodeIsParent(O,H)&&F==q.move.TYPE_INNER){return}var W=(R.parentTId?R.getParentNode():T),Q=(H===null||H==T);if(Q&&H===null){H=T}if(Q){F=q.move.TYPE_INNER}var D=(H.parentTId?H.getParentNode():T);if(F!=q.move.TYPE_PREV&&F!=q.move.TYPE_NEXT){F=q.move.TYPE_INNER}if(F==q.move.TYPE_INNER){if(Q){R.parentTId=null}else{if(!A.nodeIsParent(O,H)){A.nodeIsParent(O,H,true);H.open=!!H.open;j.setNodeLineIcos(O,H)}R.parentTId=H.tId}}var J,L;if(Q){J=O.treeObj;L=J}else{if(!I&&F==q.move.TYPE_INNER){j.expandCollapseNode(O,H,true,false)}else{if(!I){j.expandCollapseNode(O,H.getParentNode(),true,false)}}J=i(H,O);L=i(H,q.id.UL,O);if(!!J.get(0)&&!L.get(0)){var ab=[];j.makeUlHtml(O,H,ab,"");J.append(ab.join(""))}L=i(H,q.id.UL,O)}var Z=i(R,O);if(!Z.get(0)){Z=j.appendNodes(O,R.level,[R],null,-1,false,true).join("")}else{if(!J.get(0)){Z.remove()}}if(L.get(0)&&F==q.move.TYPE_INNER){L.append(Z)}else{if(J.get(0)&&F==q.move.TYPE_PREV){J.before(Z)}else{if(J.get(0)&&F==q.move.TYPE_NEXT){J.after(Z)}}}var V,U,M=-1,Y=0,ac=null,E=null,aa=R.level;var X=A.nodeChildren(O,W);var K=A.nodeChildren(O,D);var G=A.nodeChildren(O,H);if(R.isFirstNode){M=0;if(X.length>1){ac=X[1];ac.isFirstNode=true}}else{if(R.isLastNode){M=X.length-1;ac=X[M-1];ac.isLastNode=true}else{for(V=0,U=X.length;V<U;V++){if(X[V].tId==R.tId){M=V;break}}}}if(M>=0){X.splice(M,1)}if(F!=q.move.TYPE_INNER){for(V=0,U=K.length;V<U;V++){if(K[V].tId==H.tId){Y=V}}}if(F==q.move.TYPE_INNER){if(!G){G=A.nodeChildren(O,H,[])}if(G.length>0){E=G[G.length-1];E.isLastNode=false}G.splice(G.length,0,R);R.isLastNode=true;R.isFirstNode=(G.length==1)}else{if(H.isFirstNode&&F==q.move.TYPE_PREV){K.splice(Y,0,R);E=H;E.isFirstNode=false;R.parentTId=H.parentTId;R.isFirstNode=true;R.isLastNode=false}else{if(H.isLastNode&&F==q.move.TYPE_NEXT){K.splice(Y+1,0,R);E=H;E.isLastNode=false;R.parentTId=H.parentTId;R.isFirstNode=false;R.isLastNode=true}else{if(F==q.move.TYPE_PREV){K.splice(Y,0,R)}else{K.splice(Y+1,0,R)}R.parentTId=H.parentTId;R.isFirstNode=false;R.isLastNode=false}}}A.fixPIdKeyValue(O,R);A.setSonNodeLevel(O,R.getParentNode(),R);j.setNodeLineIcos(O,R);j.repairNodeLevelClass(O,R,aa);if(!O.data.keep.parent&&X.length<1){A.nodeIsParent(O,W,false);W.open=false;var P=i(W,q.id.UL,O),S=i(W,q.id.SWITCH,O),N=i(W,q.id.ICON,O);j.replaceSwitchClass(W,S,q.folder.DOCU);j.replaceIcoClass(W,N,q.folder.DOCU);P.css("display","none")}else{if(ac){j.setNodeLineIcos(O,ac)}}if(E){j.setNodeLineIcos(O,E)}if(!!O.check&&O.check.enable&&j.repairChkClass){j.repairChkClass(O,W);j.repairParentChkClassWithSelf(O,W);if(W!=R.parent){j.repairParentChkClassWithSelf(O,R)}}if(!I){j.expandCollapseParentNode(O,R.getParentNode(),true,ad)}},removeEditBtn:function(D,E){i(E,q.id.EDIT,D).unbind().remove()},removeRemoveBtn:function(D,E){i(E,q.id.REMOVE,D).unbind().remove()},removeTreeDom:function(D,E){E.isHover=false;j.removeEditBtn(D,E);j.removeRemoveBtn(D,E);v.apply(D.view.removeHoverDom,[D.treeId,E])},repairNodeLevelClass:function(E,G,F){if(F===G.level){return}var H=i(G,E),K=i(G,q.id.A,E),J=i(G,q.id.UL,E),D=q.className.LEVEL+F,I=q.className.LEVEL+G.level;H.removeClass(D);H.addClass(I);K.removeClass(D);K.addClass(I);J.removeClass(D);J.addClass(I)},selectNodes:function(G,E){for(var F=0,D=E.length;F<D;F++){j.selectNode(G,E[F],F>0)}}},t={tools:h,view:d,event:g,data:p};f.extend(true,f.fn.zTree.consts,C);f.extend(true,f.fn.zTree._z,t);var b=f.fn.zTree,v=b._z.tools,q=b.consts,j=b._z.view,A=b._z.data,s=b._z.event,i=v.$;A.exSetting(m);A.addInitBind(n);A.addInitUnBind(z);A.addInitCache(c);A.addInitNode(w);A.addInitProxy(o);A.addInitRoot(x);A.addZTreeTools(k);var u=j.cancelPreSelectedNode;j.cancelPreSelectedNode=function(F,G){var H=A.getRoot(F).curSelectedList;for(var E=0,D=H.length;E<D;E++){if(!G||G===H[E]){j.removeTreeDom(F,H[E]);if(G){break}}}if(u){u.apply(j,arguments)}};var y=j.createNodes;j.createNodes=function(G,H,E,D,F){if(y){y.apply(j,arguments)}if(!E){return}if(j.repairParentChkClassWithSelf){j.repairParentChkClassWithSelf(G,D)}};var r=j.makeNodeUrl;j.makeNodeUrl=function(D,E){return D.edit.enable?null:(r.apply(j,arguments))};var a=j.removeNode;j.removeNode=function(E,F){var D=A.getRoot(E);if(D.curEditNode===F){D.curEditNode=null}if(a){a.apply(j,arguments)}};var B=j.selectNode;j.selectNode=function(F,G,E){var D=A.getRoot(F);if(A.isSelectedNode(F,G)&&D.curEditNode==G&&G.editNameFlag){return false}if(B){B.apply(j,arguments)}j.addHoverDom(F,G);return true};var e=v.uCanDo;v.uCanDo=function(E,F){var D=A.getRoot(E);if(F&&(v.eqs(F.type,"mouseover")||v.eqs(F.type,"mouseout")||v.eqs(F.type,"mousedown")||v.eqs(F.type,"mouseup"))){return true}if(D.curEditNode){j.editNodeBlur=false;D.curEditInput.focus()}return(!D.curEditNode)&&(e?e.apply(j,arguments):true)}})(jQuery);