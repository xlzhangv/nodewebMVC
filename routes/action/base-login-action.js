/**
 * Created by Administrator on 2016/6/3.
 */
var express = require('express');
var captchapng = require('captchapng');
var md5Util=require(APP_PATH+'/util/Md5Util');
var baseLoginAction = {
    init: function (app) {
        var me =this;
        app.use('/login-out', this.loginOut);
        app.use('/login', this.login);
        app.use('/captcha', this.captcha);
        app.use('/login-submit',  this.loginSubmit);
        app.use('/checkCaptcha',this.checkCaptcha);
    },
    captcha:function(req, res, next){
        console.info("login "+new Date().getTime());


        req.session.captch = parseInt(Math.random()*9000+1000);

        var p = new captchapng(80,30,req.session.captch); // width,height,numeric captcha
        p.color(255, 255, 255, 255);  // First color: background (red, green, blue, alpha)
        p.color(37, 37, 37, 255); // Second color: paint (red, green, blue, alpha)

        var img = p.getBase64();
        var imgbase64 = new Buffer(img,'base64');
        res.send(imgbase64);
        return
    },
    checkCaptcha:function(req, res, next){
        var captcha=req.body.captcha;
        console.info('输入的验证码：'+captcha +";session:"+req.session.captch);
        if(req.session.captch==captcha){
            res.json({success: true,isCaptcha:true});
        }else{
            res.json({success: true,isCaptcha:false});
        }
        return
    },
    login: function (req, res, next) {
        console.info("login "+new Date().getTime());
        return res.render('login/main.html', {key: false});
    },
    loginOut: function (req, res, next) {
        req.session.user = null;
        res.redirect('/login');return
    },
    loginSubmit: function (req, res, next) {
        var pwd=req.body.password;
        var key=req.body.key;
        console.info("输入:"+key+":"+pwd);
        req.session.user ={
            NAME:key
        };
        req.session.menus=[{"id":"27","name":"首页","icon":"menu-home.png","active":true,"url":"bigdata","code":"","child":[{"id":"100091","name":"已收藏的应用顺序的前10个","icon":"","active":true,"url":"homeManage/getStoreApp","code":"","child":[]},{"id":"100097","name":"访问源地域排名TOP5","icon":"","active":true,"url":"homeManage/accessRegionTopFive","code":"","child":[]},{"id":"100090","name":"实时先告警事件","icon":"","active":true,"url":"warn/curr","code":"","child":[]},{"id":"100096","name":"一周告警分布","icon":"","active":true,"url":"warn/scatter","code":"","child":[]},{"id":"100089","name":"应用类型个数","icon":"","active":true,"url":"homeManage/getAppType","code":"","child":[]},{"id":"100095","name":"一周内告警类型分布","icon":"","active":true,"url":"warn/findtype","code":"","child":[]},{"id":"100088","name":"今昨两天流量告警量接口","icon":"","active":true,"url":"homeManage/getTotle","code":"","child":[]},{"id":"100094","name":"整体流量连接数","icon":"","active":true,"url":"homeManage/getFlowAndSessionBySql","code":"","child":[]},{"id":"100093","name":"5分钟变化最快TOP5","icon":"","active":true,"url":"homeManage/getAppFastOrderBySql","code":"","child":[]},{"id":"100092","name":"应用流量排名TOP5","icon":"","active":true,"url":"homeManage/getAppOrderBySql","code":"","child":[]}]},{"id":"29","name":"安全监测","icon":"menu-monitor.png","active":true,"url":"","code":"","child":[{"id":"30","name":"全网应用分析","icon":"null","active":true,"url":"analysisall","code":"","child":[{"id":"1000122","name":"ip访问连接数排行数据(外网)跳转","icon":"","active":true,"url":"module/abroadiplinkrank","code":"","child":[]},{"id":"100083","name":"协议占比分析接口","icon":"","active":true,"url":"flowAnalysis/getAppProtocolData","code":"","child":[]},{"id":"1000115","name":"应用连接数排行卡片跳转","icon":"","active":true,"url":"module/linkrank","code":"","child":[]},{"id":"100076","name":"被攻击应用排行top20接口","icon":"","active":true,"url":"warnstatis/attack","code":"","child":[]},{"id":"1000121","name":"ip访问连接数排行数据(内网)跳转","icon":"","active":true,"url":"module/withiniplinkrank","code":"","child":[]},{"id":"100082","name":"省份连接数排名接口","icon":"","active":true,"url":"flowAnalysis/getAppTopProvinceSessionData","code":"","child":[]},{"id":"1000114","name":"应用流量排行卡片跳转","icon":"","active":true,"url":"module/flowrank","code":"","child":[]},{"id":"100075","name":"全网报警饼图接口","icon":"","active":true,"url":"warnstatis/wholePer","code":"","child":[]},{"id":"1000120","name":"ip访问流量排行数据(内网)跳转","icon":"","active":true,"url":"module/withinipflowrank","code":"","child":[]},{"id":"100081","name":"省份流量排名接口","icon":"","active":true,"url":"flowAnalysis/getAppTopProvinceFlowData","code":"","child":[]},{"id":"100087","name":"获取ip访问连接数排行数据(外网)接口","icon":"","active":true,"url":"flowAnalysis/getAppTopOuterIpSessionData","code":"","child":[]},{"id":"100074","name":"流量、连接数趋势图接口","icon":"","active":true,"url":"flowAnalysis/getFlowAnalysisData","code":"","child":[]},{"id":"1000119","name":"ip访问流量排行数据(外网)跳转","icon":"","active":true,"url":"module/abroadipflowrank","code":"","child":[]},{"id":"100080","name":"应用连接数排行top20接口","icon":"","active":true,"url":"flowAnalysis/getAppTopSessionData","code":"","child":[]},{"id":"100086","name":"获取ip访问连接数排行数据(内网)接口","icon":"","active":true,"url":"flowAnalysis/getAppTopInnerIpSessionData","code":"","child":[]},{"id":"100073","name":"获取待选择缩略图卡片接口","icon":"","active":true,"url":"userPicManage/getPicToSelectList","code":"","child":[]},{"id":"1000118","name":"地域连接数排行跳转","icon":"","active":true,"url":"module/regionlinkernumrank","code":"","child":[]},{"id":"100079","name":"应用流量排行top20接口","icon":"","active":true,"url":"flowAnalysis/getAppTopFlowData","code":"","child":[]},{"id":"100085","name":"获取ip访问流量排行数据(内网)接口","icon":"","active":true,"url":"flowAnalysis/getAppTopInnerIpFlowData","code":"","child":[]},{"id":"1000117","name":"地域流量排行跳转","icon":"","active":true,"url":"module/regionflowrank","code":"","child":[]},{"id":"100078","name":"获取已选择卡片接口","icon":"","active":true,"url":"userPicManage/getPicSelectedList","code":"","child":[]},{"id":"100084","name":"获取ip访问流量排行数据(外网)接口","icon":"","active":true,"url":"flowAnalysis/getAppTopOuterIpFlowData","code":"","child":[]},{"id":"1000116","name":"协议占比分析跳转","icon":"","active":true,"url":"module/flowanalysis","code":"","child":[]},{"id":"100077","name":"告警列表接口","icon":"","active":true,"url":"warnstatis/list","code":"","child":[]}]},{"id":"31","name":"单一应用分析","icon":"null","active":true,"url":"analysissingle","code":"","child":[{"id":"1000140","name":"今日流量","icon":"","active":true,"url":"appIndexDetail/flow","code":"","child":[]},{"id":"1000126","name":"地域流量排行跳转","icon":"","active":true,"url":"module/regionflowrank","code":"","child":[]},{"id":"1000160","name":"数据库树","icon":"","active":true,"url":"module/dbtree","code":"","child":[]},{"id":"1000102","name":"告警列表接口","icon":"","active":true,"url":"warnstatis/list","code":"","child":[]},{"id":"1000146","name":"URL访问排行","icon":"","active":true,"url":"appIndexDetail/getUrlTop","code":"","child":[]},{"id":"1000132","name":"获取应用指标详情卡片接口","icon":"","active":true,"url":"userPicManage/getAppDetailPicSelectedList","code":"","child":[]},{"id":"1000166","name":"数据库客户端类型分布","icon":"","active":true,"url":"appIndexDetail/getDbClient","code":"","child":[]},{"id":"1000108","name":"获取ip访问连接数排行数据(内网)接口","icon":"","active":true,"url":"flowAnalysis/getAppTopInnerIpSessionData","code":"","child":[]},{"id":"1000152","name":"基础信息跳转","icon":"","active":true,"url":"module/basemessage","code":"","child":[]},{"id":"1000139","name":"数据库登录统计","icon":"","active":true,"url":"appIndexDetail/getDbLoginData","code":"","child":[]},{"id":"1000123","name":"url被访问排行卡片跳转","icon":"","active":true,"url":"module/urlvisitrank","code":"","child":[]},{"id":"1000159","name":"url访问情况带同比跳转","icon":"","active":true,"url":"module/appdetailurlvisitrank","code":"","child":[]},{"id":"1000101","name":"应用分类汇总","icon":"","active":true,"url":"appstatistics/classify","code":"","child":[]},{"id":"1000145","name":"数据库访问排行","icon":"","active":true,"url":"appIndexDetail/getDbTop","code":"","child":[]},{"id":"1000131","name":"ip访问连接数排行数据(外网)跳转","icon":"","active":true,"url":"module/abroadiplinkrank","code":"","child":[]},{"id":"1000165","name":"应用指标详情","icon":"","active":true,"url":"appdetail","code":"","child":[]},{"id":"1000107","name":"获取ip访问流量排行数据(内网)接口","icon":"","active":true,"url":"flowAnalysis/getAppTopInnerIpFlowData","code":"","child":[]},{"id":"1000151","name":"今日连接跳转","icon":"","active":true,"url":"module/todaylink","code":"","child":[]},{"id":"1000138","name":"访问目标流量排行","icon":"","active":true,"url":"appIndexDetail/getTopDstRank","code":"","child":[]},{"id":"1000113","name":"收藏取消收藏","icon":"","active":true,"url":"appstatistics/status","code":"","child":[]},{"id":"1000157","name":"数据库登录统计跳转","icon":"","active":true,"url":"module/databaselogincount","code":"","child":[]},{"id":"1000100","name":"全网报警饼图接口","icon":"","active":true,"url":"warnstatis/singlePer","code":"","child":[]},{"id":"1000144","name":"客户端类型分布","icon":"","active":true,"url":"appIndexDetail/getWebBrowser","code":"","child":[]},{"id":"1000130","name":"ip访问连接数排行数据(内网)跳转","icon":"","active":true,"url":"module/withiniplinkrank","code":"","child":[]},{"id":"1000164","name":"访问目标流量排行","icon":"","active":true,"url":"module/visittargetflowrank","code":"","child":[]},{"id":"1000106","name":"获取ip访问流量排行数据(外网)接口","icon":"","active":true,"url":"flowAnalysis/getAppTopOuterIpFlowData","code":"","child":[]},{"id":"1000150","name":"今日流量跳转","icon":"","active":true,"url":"module/todayflow","code":"","child":[]},{"id":"1000137","name":"源端地域分布","icon":"","active":true,"url":"appIndexDetail/getTopSrcProvince","code":"","child":[]},{"id":"1000112","name":"告警分布单一散列点","icon":"","active":true,"url":"warnstatis/scatter","code":"","child":[]},{"id":"1000156","name":"浏览器类型跳转","icon":"","active":true,"url":"module/webBrowsertype","code":"","child":[]},{"id":"100099","name":"流量、连接数趋势图接口","icon":"","active":true,"url":"flowAnalysis/getFlowAnalysisData","code":"","child":[]},{"id":"1000143","name":"基础信息","icon":"","active":true,"url":"appIndexDetail/appinfo","code":"","child":[]},{"id":"1000129","name":"ip访问流量排行数据(内网)跳转","icon":"","active":true,"url":"module/withinipflowrank","code":"","child":[]},{"id":"1000163","name":"远程节点类型分布","icon":"","active":true,"url":"module/remotenodetype","code":"","child":[]},{"id":"1000105","name":"省份连接数排名接口","icon":"","active":true,"url":"flowAnalysis/getAppTopProvinceSessionData","code":"","child":[]},{"id":"1000149","name":"报警列表跳转","icon":"","active":true,"url":"module/alarmlist","code":"","child":[]},{"id":"1000136","name":"源端ip排行","icon":"","active":true,"url":"appIndexDetail/getTopSrcIp","code":"","child":[]},{"id":"1000170","name":"操作系统类型跳转","icon":"","active":true,"url":"module/webOstype","code":"","child":[]},{"id":"1000111","name":"应用分类汇总获取第一个应用","icon":"","active":true,"url":"appstatistics/classifyFirst","code":"","child":[]},{"id":"1000155","name":"远程节点类型分布跳转","icon":"","active":true,"url":"module/remotenodetype","code":"","child":[]},{"id":"100098","name":"获取待选择缩略图卡片接口","icon":"","active":true,"url":"userPicManage/getPicToSelectList","code":"","child":[]},{"id":"1000142","name":"告警列表","icon":"","active":true,"url":"appIndexDetail/warnlist","code":"","child":[]},{"id":"1000128","name":"ip访问流量排行数据(外网)跳转","icon":"","active":true,"url":"module/abroadipflowrank","code":"","child":[]},{"id":"1000162","name":"源端IP排行","icon":"","active":true,"url":"module/sourceiprank","code":"","child":[]},{"id":"1000104","name":"省份流量排名接口","icon":"","active":true,"url":"flowAnalysis/getAppTopProvinceFlowData","code":"","child":[]},{"id":"1000148","name":"数据库访问排行","icon":"","active":true,"url":"appIndexDetail/getDbTop","code":"","child":[]},{"id":"1000135","name":"获取应用关系球数据(应用指标详情中间大球)","icon":"","active":true,"url":"appIndexDetail/getAppRelation","code":"","child":[]},{"id":"1000169","name":"操作系统访问次数","icon":"null","active":true,"url":"appIndexDetail/getWebOs","code":"null","child":[]},{"id":"1000110","name":"获取url被访问排行","icon":"","active":true,"url":"flowAnalysis/getAppTopUrlData","code":"","child":[]},{"id":"1000154","name":"源端地域排行跳转","icon":"","active":true,"url":"module/sourceregion","code":"","child":[]},{"id":"1000141","name":"今日连接数","icon":"","active":true,"url":"appIndexDetail/session","code":"","child":[]},{"id":"1000127","name":"地域连接数排行跳转","icon":"","active":true,"url":"module/regionlinkernumrank","code":"","child":[]},{"id":"1000161","name":"url树","icon":"","active":true,"url":"module/dbtree","code":"","child":[]},{"id":"1000103","name":"获取已选择卡片接口","icon":"","active":true,"url":"userPicManage/getPicSelectedList","code":"","child":[]},{"id":"1000147","name":"远程节点类型分布","icon":"","active":true,"url":"appIndexDetail/getClientType","code":"","child":[]},{"id":"1000134","name":"获取应用指标详情树接口","icon":"","active":true,"url":"appIndexDetail/getTreeData","code":"","child":[]},{"id":"1000167","name":"获取url被访问排行不带同比","icon":"","active":true,"url":"appIndexDetail/getUrlTopNoCompare","code":"","child":[]},{"id":"1000109","name":"获取ip访问连接数排行数据(外网)接口","icon":"","active":true,"url":"flowAnalysis/getAppTopOuterIpSessionData","code":"","child":[]},{"id":"1000153","name":"数据库客户端类型分布跳转","icon":"","active":true,"url":"module/dbclienttype","code":"","child":[]}]},{"id":"32","name":"应用关系发现","icon":"null","active":true,"url":"apprelationship","code":"","child":[{"id":"1000168","name":"应用关系","icon":"null","active":true,"url":"relation/findRelation","code":"null","child":[]}]}]},{"id":"34","name":"告警管理","icon":"menu-alarm.png","active":true,"url":"","code":"","child":[{"id":"50","name":"告警管理","icon":"","active":true,"url":"static/allstatic/modelsettings/alarmList.html","code":"","child":[]},{"id":"51","name":"告警趋势","icon":"","active":true,"url":"static/allstatic/modelsettings/analysis.html","code":"","child":[]}]},{"id":"21","name":"资产档案","icon":"menu-archives.png","active":true,"url":"null","code":"null","child":[{"id":"22","name":"应用系统","icon":"null","active":true,"url":"applysystem","code":"1023","child":[{"id":"100029","name":"获取应用列表接口","icon":"","active":true,"url":"appManage/getAppList","code":"","child":[]},{"id":"100030","name":"增加应用接口","icon":"","active":true,"url":"appManage/addApp","code":"","child":[]},{"id":"100031","name":"跳转到修改应用页面接口","icon":"","active":true,"url":"appManage/getAppById","code":"","child":[]},{"id":"100032","name":"修改应用接口","icon":"","active":true,"url":"appManage/updateApp","code":"","child":[]},{"id":"100033","name":"删除应用接口","icon":"","active":true,"url":"appManage/deleteApp","code":"","child":[]},{"id":"100034","name":"导出应用接口","icon":"","active":true,"url":"appManage/exportApp","code":"","child":[]},{"id":"100035","name":"下载应用管理模板接口","icon":"","active":true,"url":"appManage/exportAppTemplet","code":"","child":[]},{"id":"100036","name":"导入应用接口","icon":"","active":true,"url":"appManage/importApp","code":"","child":[]}]},{"id":"23","name":"数据库","icon":"null","active":true,"url":"database","code":"1024","child":[{"id":"100037","name":"获取数据库列表的接口","icon":"","active":true,"url":"dbManage/getDBInfo","code":"","child":[]},{"id":"100038","name":"跳转到数据库修改页面的接口","icon":"","active":true,"url":"dbManage/getDBInfoByID","code":"","child":[]},{"id":"100039","name":"增加mysql数据库接口","icon":"","active":true,"url":"dbManage/addMysqlInfo","code":"","child":[]},{"id":"100040","name":"增加oracle数据库接口","icon":"","active":true,"url":"dbManage/addOracleInfo","code":"","child":[]},{"id":"100041","name":"增加sqlserver数据库接口","icon":"","active":true,"url":"dbManage/addSqlserverInfo","code":"","child":[]},{"id":"100042","name":"修改mysql数据库接口","icon":"","active":true,"url":"dbManage/editMysqlInfo","code":"","child":[]},{"id":"100043","name":"修改oracle数据库接口","icon":"","active":true,"url":"dbManage/editOracleInfo","code":"","child":[]},{"id":"100044","name":"修改sqlserver数据库接口","icon":"","active":true,"url":"dbManage/editSqlserverInfo","code":"","child":[]},{"id":"100045","name":"删除数据库接口","icon":"","active":true,"url":"dbManage/deleteDB","code":"","child":[]},{"id":"100046","name":"导出数据库接口","icon":"","active":true,"url":"dbManage/exportDb","code":"","child":[]},{"id":"100047","name":"下载数据库管理模板的接口","icon":"","active":true,"url":"dbManage/exportDbTemplet","code":"","child":[]},{"id":"100048","name":"导入数据库的接口","icon":"","active":true,"url":"dbManage/importDb","code":"","child":[]}]},{"id":"24","name":"服务器","icon":"null","active":true,"url":"server","code":"1025","child":[{"id":"100013","name":"获取日志查询列表的接口","icon":"","active":true,"url":"log/list","code":"","child":[]},{"id":"100014","name":"获取日志操作类型下拉列表的接口","icon":"","active":true,"url":"log/type","code":"","child":[]},{"id":"100049","name":"获取服务器列表接口","icon":"","active":true,"url":"serverManage/getServerList","code":"","child":[]},{"id":"100050","name":"增加服务器接口","icon":"","active":true,"url":"serverManage/addServer","code":"","child":[]},{"id":"100051","name":"调整到修改服务器页面接口","icon":"","active":true,"url":"serverManage/getServerById","code":"","child":[]},{"id":"100052","name":"修改服务器接口","icon":"","active":true,"url":"serverManage/updateServer","code":"","child":[]},{"id":"100053","name":"删除服务器接口","icon":"","active":true,"url":"serverManage/deleteServer","code":"","child":[]},{"id":"100054","name":"导出服务器接口","icon":"","active":true,"url":"serverManage/exportServer","code":"","child":[]},{"id":"100055","name":"下载服务器模板接口","icon":"","active":true,"url":"serverManage/exportServerTemplet","code":"","child":[]},{"id":"100056","name":"导入服务器接口","icon":"","active":true,"url":"serverManage/importServer","code":"","child":[]}]},{"id":"25","name":"硬件资产","icon":"null","active":true,"url":"hardasset","code":"1026","child":[{"id":"100057","name":"获取硬件资产列表的接口","icon":"","active":true,"url":"hardAssets/list","code":"","child":[]},{"id":"100058","name":"添加硬件资产的接口","icon":"","active":true,"url":"hardAssets/save","code":"","child":[]},{"id":"100059","name":"跳转到硬件资产修改页面的接口","icon":"","active":true,"url":"hardAssets/toupdate","code":"","child":[]},{"id":"100060","name":"修改硬件资产的接口","icon":"","active":true,"url":"hardAssets/update","code":"","child":[]},{"id":"100061","name":"删除硬件资产的接口","icon":"","active":true,"url":"hardAssets/del","code":"","child":[]},{"id":"100062","name":"导出硬件资产的接口","icon":"","active":true,"url":"hardAssets/export","code":"","child":[]},{"id":"100063","name":"下载硬件资产模板的接口","icon":"","active":true,"url":"hardAssets/templet","code":"","child":[]},{"id":"100064","name":"导入硬件资产的接口","icon":"","active":true,"url":"hardAssets/import","code":"","child":[]}]},{"id":"26","name":"资产审核","icon":"null","active":true,"url":"applicationAudit","code":"1027","child":[{"id":"100065","name":"查询待审核应用列表接口","icon":"","active":true,"url":"application/pending","code":"","child":[]},{"id":"100066","name":"查询已审核应用接口","icon":"","active":true,"url":"application/checked","code":"","child":[]},{"id":"100067","name":"查询已拒绝应用接口","icon":"","active":true,"url":"application/refused","code":"","child":[]},{"id":"100068","name":"搜索应用接口","icon":"","active":true,"url":"application/search","code":"","child":[]},{"id":"100069","name":"跳转审核页面接口","icon":"","active":true,"url":"application/tocheck","code":"","child":[]},{"id":"100070","name":"审核应用为已通过功能接口","icon":"","active":true,"url":"application/pass","code":"","child":[]},{"id":"100071","name":"审核应用为已拒绝功能接口","icon":"","active":true,"url":"application/refuse","code":"","child":[]},{"id":"100072","name":"保存应用接口","icon":"","active":true,"url":"application/save","code":"","child":[]}]}]},{"id":"46","name":"安全模型","icon":"menu-model.png","active":true,"url":"","code":"","child":[{"id":"47","name":"数据统计","icon":"","active":true,"url":"static/allstatic/modelsettings/statistics.html","code":"1028","child":[]},{"id":"48","name":"应用关联","icon":"","active":true,"url":"static/allstatic/modelsettings/appRelation.html","code":"1028","child":[]},{"id":"49","name":"模型配置","icon":"","active":true,"url":"static/allstatic/modelsettings/modelConfig.html","code":"1028","child":[]}]},{"id":"52","name":"IP画像管理","icon":"menu-ipportrait.png","active":true,"url":"","code":"","child":[{"id":"53","name":"IP画像任务","icon":"","active":true,"url":"ipportraitmanage","code":"","child":[{"id":"1000176","name":"删除任务","icon":"","active":true,"url":"task/deleteTask","code":"","child":[]},{"id":"1000195","name":"访问行为协议占比卡片跳转","icon":"","active":true,"url":"module/ipattackflowanalysis","code":"","child":[]},{"id":"1000182","name":"ip画像访问目标行为排行","icon":"","active":true,"url":"ipPortrait/getVisitJson","code":"","child":[]},{"id":"1000188","name":"根据ip画像类型获取卡片列表信息","icon":"","active":true,"url":"userPicManage/getPortraitPicList","code":"","child":[]},{"id":"1000175","name":"查看任务","icon":"","active":true,"url":"task/viewTask","code":"","child":[]},{"id":"1000194","name":"关联报警卡片跳转","icon":"","active":true,"url":"module/ipalarmrelevance","code":"","child":[]},{"id":"1000181","name":"ip画像连接数趋势图","icon":"","active":true,"url":"ipPortrait/getPortraitSessionData","code":"","child":[]},{"id":"1000187","name":"访问时间分布","icon":"","active":true,"url":"ipPortrait/getVisitTime","code":"","child":[]},{"id":"1000174","name":"添加任务","icon":"","active":true,"url":"task/addTask","code":"","child":[]},{"id":"1000193","name":"访问目标行为排行top10卡片跳转","icon":"","active":true,"url":"module/ipvisitTargetactionrank","code":"","child":[]},{"id":"1000180","name":"ip画像流量趋势图","icon":"","active":true,"url":"ipPortrait/getPortraitFlowData","code":"","child":[]},{"id":"1000186","name":"关联报警获取告警列表","icon":"","active":true,"url":"ipPortrait/getWarnList","code":"","child":[]},{"id":"1000173","name":"获取IP画像任务列表个任务类型总数","icon":"","active":true,"url":"task/getTaskStateCount","code":"","child":[]},{"id":"1000192","name":"被访问排行top10卡片跳转","icon":"","active":true,"url":"module/ipvisitactionrank","code":"","child":[]},{"id":"1000179","name":"ip画像基础信息","icon":"","active":true,"url":"ipPortrait/getBaseInfo","code":"","child":[]},{"id":"1000185","name":"ip画像行为轨迹","icon":"","active":true,"url":"ipPortrait/getTrackJson","code":"","child":[]},{"id":"1000172","name":"获取ip画像任务列表","icon":"","active":true,"url":"task/getTaskList","code":"","child":[]},{"id":"1000191","name":"连接数趋势图卡片跳转","icon":"","active":true,"url":"module/iplinknumtendencychart","code":"","child":[]},{"id":"1000178","name":"ip画像页面创建时间下拉列表","icon":"","active":true,"url":"ipPortrait/getCreateTimeList","code":"","child":[]},{"id":"1000197","name":"行为轨迹卡片跳转","icon":"","active":true,"url":"module/actioncontrail","code":"","child":[]},{"id":"1000184","name":"ip画像访问协议占比","icon":"","active":true,"url":"ipPortrait/getProtocolJson","code":"","child":[]},{"id":"1000190","name":"流量趋势图卡片跳转","icon":"","active":true,"url":"module/ipflowtendencychart","code":"","child":[]},{"id":"1000177","name":"ip画像页面跳转","icon":"","active":true,"url":"ipportrait","code":"","child":[]},{"id":"1000196","name":"时间分布卡片跳转","icon":"","active":true,"url":"module/iptimedistribution","code":"","child":[]},{"id":"1000183","name":"ip画像被访问行为排行","icon":"","active":true,"url":"ipPortrait/getVisitedJson","code":"","child":[]},{"id":"1000189","name":"基础信息卡片跳转","icon":"","active":true,"url":"module/ipbasemessage","code":"","child":[]}]}]},{"id":"54","name":"数据审计","icon":"dataaudit.png","active":true,"url":"","code":"","child":[{"id":"55","name":"数据审计","icon":"","active":true,"url":"dataaudit","code":"","child":[{"id":"1000206","name":"查看数据详情","icon":"","active":true,"url":"dataAudit/dataAuditByParam","code":"","child":[]},{"id":"1000199","name":"获取协议属性列表","icon":"","active":true,"url":"dataAudit/attListById","code":"","child":[]},{"id":"1000205","name":"取消impala查询","icon":"","active":true,"url":"dataAudit/cancelRate","code":"","child":[]},{"id":"1000198","name":"获取协议列表","icon":"","active":true,"url":"dataAudit/proList","code":"","child":[]},{"id":"1000204","name":"协议总数","icon":"","active":true,"url":"dataAudit/dataCountByProId","code":"","child":[]},{"id":"1000203","name":"协议执行计划","icon":"","active":true,"url":"dataAudit/dataPlan","code":"","child":[]},{"id":"1000202","name":"进度","icon":"","active":true,"url":"dataAudit/dataRate","code":"","child":[]},{"id":"1000208","name":"查询表头","icon":"","active":true,"url":"dataAudit/showHeader","code":"","child":[]},{"id":"1000201","name":"数据审计列表","icon":"","active":true,"url":"dataAudit/dataAuditList","code":"","child":[]},{"id":"1000207","name":"导出审计数据","icon":"","active":true,"url":"dataAudit/exportData","code":"","child":[]},{"id":"1000200","name":"启动implala查询任务","icon":"","active":true,"url":"dataAudit/startSearchTask","code":"","child":[]}]}]},{"id":"43","name":"统计报表","icon":"menu-report.png","active":true,"url":"","code":"","child":[{"id":"45","name":"报表管理","icon":"null","active":true,"url":"reportmanage","code":"","child":[{"id":"1000210","name":"添加报表","icon":"","active":true,"url":"report/add","code":"","child":[]},{"id":"1000209","name":"报表列表","icon":"","active":true,"url":"report/list","code":"","child":[]},{"id":"1000215","name":"报表下载","icon":"null","active":true,"url":"report/checkLoadWord","code":"null","child":[]},{"id":"1000214","name":"预览报表","icon":"","active":true,"url":"report/loadWord","code":"","child":[]},{"id":"1000213","name":"邮件测试","icon":"","active":true,"url":"report/testEmail","code":"","child":[]},{"id":"1000212","name":"删除报表","icon":"","active":true,"url":"report/del","code":"","child":[]},{"id":"1000211","name":"修改报表","icon":"","active":true,"url":"report/update","code":"","child":[]}]}]},{"id":"5","name":"系统管理","icon":"menu-system.png","active":true,"url":"null","code":"null","child":[{"id":"1000171","name":"系统授权","icon":"","active":true,"url":"license","code":"","child":[{"id":"1000216","name":"登录授权","icon":"","active":true,"url":"loginLicense","code":"","child":[]}]},{"id":"56","name":"后台管理","icon":"ipportrait.png","active":true,"url":"Topwalk-SIP3.0/home","code":"","child":[]}]}]
         res.redirect('/home');return
        // ajax({
        //     url:'http://192.168.23.88:8080/fusion/rest/loginRest/loginToAdd',
        //     data:{
        //         admin : username,
        //         password : pwd
        //     },
        //     type:'post',
        //     success:function (data) {
        //         var result = {success: true,code:'200',url: '/index'};
        //         if (data.result.flag === '1') {
        //             req.session.user = username;
        //         } else {
        //             result = {success: false,code:'用户名或密码错误！'};
        //         }
        //         res.json(result);
        //     },
        //     error:function (e) {
        //         console.info(e);
        //     }
        // });

        // secUserServer.userLogin(username, function(rows){
        //     if(rows.length!=0){
        //         pwd = md5Util.encrypt(pwd);
        //         if(rows[0]['PASSWORD']==pwd){
        //             req.session.user = rows[0]['NAME'];
        //             res.json({success: true,code:'200',url: '/index'});
        //         }else{
        //             res.json({success: false,code:'用户名或密码错误！'});
        //         }
        //     }else{
        //         res.json({success: false,code:'用户名不存在！'});
        //     }
        // });
    }

}
module.exports = baseLoginAction;